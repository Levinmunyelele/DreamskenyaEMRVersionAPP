<ion-header>
  <ion-toolbar>
    <ion-title>Screening Form</ion-title>
    <ion-buttons slot="start">
      <ion-back-button default-href="home"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>

  <div class="screening-header">

    <div class="avatar">
      <span>{{ avatar }}</span> <!-- Show initials as avatar -->
    </div>
    <div class="user-info">
      <p><strong></strong> {{ name }}</p>
      <p><strong>ID:</strong> {{ id }}</p>
    </div>
  </div>
  <form [formGroup]="screeningForm" (ngSubmit)="submitForm()">

    <ion-card>
      <ion-card-header>
        <ion-card-title>Visit Details</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div>
          <label>Date</label>
          <input type="date" class="custom-input" [min]="minYear" [max]="maxYear" formControlName="encounterDatetime">

          <label>Provider</label>
          <select formControlName="selectedProviderUuid" (change)="onProviderChange()">
            <option value="" disabled>Select a Provider</option>
            <option *ngFor="let provider of providers" [value]="provider.uuid">
              {{ provider.display }}
            </option>
          </select>

          <label>Location</label>
          <select formControlName="selectedLocationUuid" (change)="onLocationChange()">
            <option value="" disabled>Select a Location</option>
            <option *ngFor="let location of locations" [value]="location.uuid">
              {{ location.display }}
            </option>
          </select>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Demographic Screening Section -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Demographic Screening</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div formArrayName="responses">
          <div *ngFor="let question of questions.slice(0, 10); let i = index">
            <div *ngIf="!question.hide" class="question-container">
              <div *ngIf="question.type === 'dropdown'">
                <label>{{ question.label }}</label>
                <select [formControlName]="i">
                  <option *ngFor="let option of question.options" [value]="option.value">
                    {{ option.label }}
                  </option>
                </select>
              </div>
              <div *ngIf="question.type === 'text'">
                <label>{{ question.label }}</label>
                <input type="text" [formControlName]="i" />
              </div>
              <div *ngIf="question.type === 'textarea'">
                <label>{{ question.label }}</label>
                <textarea [formControlName]="i"></textarea>
              </div>
              <div *ngIf="question.type === 'date'">
                <label>{{ question.label }}</label>
                <input type="date" [formControlName]="i" [min]="minYear" [max]="maxYear" />
              </div>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Vulnerability Screening</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div formArrayName="responses">
          <div *ngFor="let question of questions.slice(10); let i = index">
            <div class="question-container">
              <div *ngIf="question.type === 'dropdown'">
                <label>{{ question.label }}</label>
                <select [formControlName]="(i + 10).toString()">
                  <option *ngFor="let option of question.options" [value]="option.value">
                    {{ option.label }}
                  </option>
                </select>
              </div>
              <div *ngIf="question.type === 'radio'">
                <label>{{ question.label }}</label>
                <div *ngFor="let option of question.options">
                  <label>
                    <input type="radio" [formControlName]="(i + 10).toString()" [value]="option.value" />
                    {{ option.label }}
                  </label>
                </div>
              </div>
              
             <div *ngIf="question.type === 'text'">
                <label>{{ question.label }}</label>
                <input type="text" [formControlName]="(i + 10).toString()" />
              </div>
              
              <div *ngIf="question.type === 'textarea'">
                <label>{{ question.label }}</label>
                <textarea [formControlName]="(i + 10).toString()"></textarea>
              </div>
            </div>
          </div>
        </div>
        
      </ion-card-content>
    </ion-card>    

    <button type="submit" [disabled]="screeningForm.invalid" class="btn btn-primary mt-3">
      Submit
    </button>
  </form>
</ion-content>